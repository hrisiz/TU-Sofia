package plugin.gitlab.views;

import java.awt.Color;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;

import org.eclipse.swt.widgets.*;
import org.eclipse.ui.part.ViewPart;
import org.json.JSONArray;
import org.json.JSONObject;

import plugin.gitlab.api.GitLabApi;



public class GitLabView extends ViewPart {
    private Button button;
    private GitLabApi gitLabAPI;
    public GitLabView() {
        super();
        gitLabAPI = new GitLabApi();
    }
    public void setFocus() {
    	label.setFocus();
    }
    
	public void createPartControl(Composite parent) {
		
		button = new Button(parent, 0);
		String label_text = new String();
		JSONArray jsonGroupsArray = new JSONArray(gitLabAPI.GitLabGetRequest("https://gitlab.com/api/v4/groups"));
		for(Object group_o : jsonGroupsArray )
		{
			JSONObject group = (JSONObject) group_o;
			Label label = new Label(parent, 0);
			label.setText(group.getInt("id") + " " + group.getString("name"));
			JSONArray jsonProjectsArray = new JSONArray(gitLabAPI.GitLabGetRequest("https://gitlab.com/api/v4/groups/" + group.getInt("id") + "/projects"));
			for(Object project_o : jsonProjectsArray )
			{
				JSONObject project = (JSONObject) project_o;
				button.setText(project.getString("name"));
				label_text += "- \t" + project.getString("name") + "\n";
			}
		}
		label.setText(label_text);
	}
}
