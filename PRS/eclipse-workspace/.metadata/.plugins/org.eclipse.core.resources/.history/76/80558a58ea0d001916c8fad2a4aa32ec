package plugin.gitlab.views;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;

import org.eclipse.swt.widgets.*;
import org.eclipse.ui.part.ViewPart;
import org.json.JSONArray;
import org.json.JSONObject;

import plugin.gitlab.api.GitLabApi;



public class GitLabView extends ViewPart {
    private Label label;
    private GitLabApi gitLabAPI;
    public GitLabView() {
            super();
    }
    public void setFocus() {
    	label.setFocus();
    }
    
	public void createPartControl(Composite parent) {
		label = new Label(parent, 0);
		JSONArray jsonGroupsArray = new JSONArray(gitLabAPI.GitLabGetRequest("https://gitlab.com/api/v4/groups"));
		for(Object group_o : jsonGroupsArray )
		{
			JSONObject group = (JSONObject) group_o;
			label.setText(group.getString("name"));
			JSONArray jsonProjectsArray = new JSONArray(gitLabAPI.GitLabGetRequest("https://gitlab.com/api/v4/groups/" + group.getString("id") + "/projects"));
			for(Object project_o : jsonProjectsArray )
			{
				JSONObject project = (JSONObject) project_o;
				label.setText("\t" + project.getString("name"));
			}
		}
	}
}
