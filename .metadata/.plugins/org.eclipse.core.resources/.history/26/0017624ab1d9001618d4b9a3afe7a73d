import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintStream;
import java.net.Socket;
import java.util.Scanner;
// това е нишката която ще обработва абсолютно всеки свързал се клиент.
// Тук ще се разбира какъв е този клиент, който се е свързал.
// За целта ще се използва потребителско име и парола, които ще са записани във файл.
public class ServerThread extends Thread{ // създаваме класа и наследяваме Thread за да стане нишка
	private Socket socket; 
	private static final File usersFile = new File("users"); // създавам константа на файлът, който съдържа потребителите
	
	public ServerThread(Socket socket) { //Конструктора приема сокета(порта) за да може да знае класа как ще комуникира със клиента
		this.socket = socket;
	}
	
	private UserType checkUser(String username,String password){ // създавам метод, който ще идентифицира клиента като потребител и ще върне какъв тип е потребителя
		return UserType.Student;
	}
	
	@Override
	public void run() {
		try {
			Scanner sc = new Scanner(socket.getInputStream()); // отварям scanner за четене от клиента
			String[] userFields = sc.nextLine().split("/"); // прочитам от клиента един ред
			BufferedReader br = new BufferedReader(new FileReader(usersFile)); // отварям файлът с потребителите
			String row = null;
			while((row = br.readLine()) != null){
				String[] user = row.split(","); // взимам поредния потребител от файлът
				if(user[0].equals(userFields[0]) && user[1].equals(userFields[1])){ // проверявам дали потребителя от файлът е еднакъв с подадения
					if(user[2].equals("Student")){ // проверявам дали потребителя е студент 
						new Student().start(); //стартирам студентска нишка 
					}
					if(user[2].equals("Secretary")){ // проверявам дали потребитя е секретарка
						new Secretary().start(); //стартирам нишка на секретарка
					}
					break;
				}
			}
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
	}
}
